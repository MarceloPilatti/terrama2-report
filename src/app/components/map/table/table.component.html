<br />

<p-table dataKey="gid"
        [value]="tableData"
        [(selection)]="selectedProperties"
        [paginator]="true"
        [rows]="selectedRowsPerPage"
        [scrollable]="true"
        [scrollHeight]="tableHeight"
        [responsive]="true"
        [columns]="selectedColumns"
        [reorderableColumns]="true"
        [resizableColumns]="true"
        [lazy]="true"
        [totalRecords]="totalRecords"
        [loading]="loading"
        exportFilename="Satélite_Alertas_CAR"
        [rowTrackBy]="trackById"
        responsive="true"
        rowExpandMode="single"
        (onLazyLoad)="onLazyLoad($event)"
        (onRowExpand)="onRowExpand($event)"
        (onRowSelect)="onRowSelect()"
        loadingIcon="fas fa-circle-notch color-black"
        (onHeaderCheckboxToggle)="onHeaderCheckboxToggle($event)"
        (onRowUnselect)="onRowUnselect()">

    <ng-template pTemplate="caption">
        <div class="p-grid p-nogutter">

            <div class="p-col-12 p-md-6 p-col-nogutter">

                <div class="float-left">

                    <p-multiSelect [options]="columns"
                                    [(ngModel)]="selectedColumns"
                                    optionLabel="header"
                                    selectedItemsLabel="{0} columns selected"
                                    [style]="{minWidth: '200px'}"
                                    defaultLabel="Selecione as colunas">
                    </p-multiSelect>

                    &nbsp;&nbsp;

                    <p-dropdown
                        [options]="rowsPerPage"
                        [(ngModel)]="selectedRowsPerPage"
                        [style]="{minWidth: '500px'}"
                        (onChange)="onRowsPerPageChange($event)">
                    </p-dropdown>

                    &nbsp;&nbsp;

                    <p-dropdown #selectedLayersDropdown
                        *ngIf="!tableReportActive"
                        [options]="selectedLayers"
                        [(ngModel)]="selectedLayerValue"
                        [style]="{minWidth: '300px'}"
                        placeholder="Layers"
                        (onChange)="onSelectedLayerChange(selectedLayersDropdown)">
                    </p-dropdown>

                    &nbsp;&nbsp;

                    <p-dropdown #selectedFilter
                        *ngIf="tableReportActive"
                        [options]="filters"
                        [(ngModel)]="selectedFilterValue"
                        (onChange)="onFilterChange(selectedFilter)">
                    </p-dropdown>

                </div>
            </div>

            <div class="p-col-12 p-md-6 p-col-nogutter">

                <div class="float-right">

<!--                    <p-multiSelect *ngIf="tableReportActive"-->
<!--                                   [options]="formats"-->
<!--                                   [(ngModel)]="selectedFormats"-->
<!--                                   [style]="{minWidth: '16rem'}"-->
<!--                                   [disabled]="isExportDisabled"-->
<!--                                   maxSelectedLabels="4"-->
<!--                                   defaultLabel="Selecione um formato"-->
<!--                                   [filter]="false"-->
<!--                                   style="vertical-align: middle">-->
<!--                    </p-multiSelect>-->

<!--                    &nbsp;&nbsp;-->

<!--                    <button-->
<!--                        *ngIf="tableReportActive"-->
<!--                        pButton-->
<!--                        class="ui-button-raised"-->
<!--                        type="button"-->
<!--                        icon="fas fa-save"-->
<!--                        iconPos="left"-->
<!--                        label="Exportar"-->
<!--                        [disabled]="isExportDisabled"-->
<!--                        pTooltip="Exportar selecionados"-->
<!--                        (click)="onExportClick()"-->
<!--                        tooltipPosition="top">-->
<!--                    </button>-->

                    &nbsp;&nbsp;

                    <button
                        *ngIf="tableReportActive"
                        pButton
                        class="ui-button-raised"
                        type="button"
                        icon="fas fa-map-marker-alt"
                        iconPos="left"
                        label="Visualizar no mapa"
                        [disabled]="isExportDisabled"
                        (click)="onShowMapClicked()"
                        pTooltip="Visualizar selecionados no mapa"
                        tooltipPosition="top">
                    </button>

                </div>

            </div>

        </div>
    </ng-template>

    <ng-template pTemplate="header" let-columns>
        <tr>
            <th *ngIf="tableReportActive"
                style="width: 2.5em"></th>
            <th style="width: 3.2em"></th>
            <th *ngIf="tableReportActive" style="width: 3.2em">
                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            </th>
            <th *ngFor="let col of columns; trackBy: trackById" [pSortableColumn]="col.field" pReorderableColumn pResizableColumn>
                {{col.header}}
                <p-sortIcon [field]="col.field"></p-sortIcon>
            </th>
            <th *ngIf="tableReportActive" pResizableColumn></th>
        </tr>
    </ng-template>

    <ng-template pTemplate="body"
                let-rowData
                let-columns="columns"
                let-expanded="expanded">
        <tr [pSelectableRow]="rowData">
            <td *ngIf="tableReportActive"
                style="width: 2.5em">
                <a [pRowToggler]="rowData" >
                    <i [ngClass]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></i>
                </a>
            </td>
            <td style="width: 3.2em">
                <i style="font-size: 1.6em;" [ngClass]="rowData.has_pdf ? 'pi pi-file-pdf' : 'pi pi-file-o'"></i>
            </td>
            <td *ngIf="tableReportActive"
                style="width:3em">
                <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
            </td>
            <td *ngFor="let col of columns; trackBy: trackById" class="ui-resizable-column">
                {{rowData[col.field]}}
            </td>
            <td *ngIf="tableReportActive">
                <button *ngIf="tableReportActive && showDeter"
                        class="btn ui-button-raised view-report-icon"
                        routerLink="/finalReport/deter/{{getRegister(rowData)}}"
                        pButton
                        pTooltip="Visualisar relatório Deter"
                        tooltipPosition="top">
                    <img src="assets/img/ico/deter32x32.png" />
                </button>
                <button *ngIf="tableReportActive && showProdes"
                        routerLink="/finalReport/prodes/{{getRegister(rowData)}}"
                        pButton
                        class="btn ui-button-raised view-report-icon icon-margin"
                        pTooltip="Visualisar relatório Prodes"
                        tooltipPosition="top">
                    <img src="assets/img/ico/prodes32x32.png" />
                </button>
                <button *ngIf="tableReportActive && showBurn"
                        routerLink="/finalReport/queimada/{{getRegister(rowData)}}"
                        pButton
                        disabled
                        class="btn ui-button-raised view-report-icon icon-margin"
                        pTooltip="Visualisar relatório Queimada"
                        tooltipPosition="top">
                    <img src="assets/img/ico/queima.ico" />
                </button>
                <button pButton
                        *ngIf="tableReportActive"
                        class="btn ui-button-raised view-report-icon icon-margin"
                        (click)="onShowMapClicked(rowData)"
                        pTooltip="Visualizar no mapa">
                    <i class="fa fa-map-marker-alt marker-icon"></i>
                </button>
            </td>
        </tr>
    </ng-template>

    <ng-template pTemplate="rowexpansion">
        <tr>
            <td [attr.colspan]="selectedColumns.length + 4">
                <div class="p-grid text-left" *ngIf="reports.length > 0">
                    <div class="p-col" *ngFor="let report of reports; trackBy: trackById">
                        <button pButton
                            class="report-history-item ui-button-raised report-button"
                            pTooltip="Baixar relatório"
                            [label]="report.name"
                            tooltipPosition="top"
                            (click)="getReport(report)">
                            {{ report.createdAt | date:'dd/MM/yyyy HH:mm:ss' }}
                        </button>
                    </div>
                </div>
                <div class="p-grid text-center" *ngIf="reports.length === 0">
                    <h4 class="p-col text-center">Não possui relatórios gerados!</h4>
                </div>
            </td>
        </tr>
    </ng-template>

    <ng-template pTemplate="paginatorleft" let-state>
        <br />
        &nbsp;&nbsp;<strong>{{ state.totalRecords }} registros</strong>
        &nbsp;&nbsp;<strong *ngIf="tableReportActive">{{ selectedProperties ? selectedProperties?.length : '0' }} selecionados</strong>
    </ng-template>

</p-table>
